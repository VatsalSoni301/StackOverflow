{% extends 'home_base.html' %}
{% block head %}

<head>
    <title>Bookmark</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/ques_ans.css">
    <script type="text/javascript" src="{{ url_for('static', filename='static_1/js/que_ans.js') }}"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote-lite.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote-lite.js"></script>

    <script>
        $(document).ready(function () {
            $('#summernote').summernote();
        });

        function validate() {
            var markupStr = $('#summernote').val()
            cleaned = jQuery(markupStr).text();

            if (markupStr == '' || markupStr == "<br>" || cleaned == '') {
                document.getElementById("msg").innerHTML = "Please Enter Content or if you only have image, add some text for explanation";
                $('#myModal11').modal('show');
            }
            else {
                qid1 = document.getElementById("qid").value;
                $.post("/post_answer",
                    {
                        editordata: markupStr,
                        qid: qid1
                    },
                    function (data, status) {
                        $("#refreshid").load(location.href + " #refreshid");
                        $('#summernote').summernote('insertText','');
                    }
                );
            }
        }
        function validatecomment(x) {
            var qid = document.getElementById("que__id").value;
            var aid = document.getElementById(x.getAttribute("id")+"ansid").value;
            var cmntbox = document.getElementById(x.getAttribute("id")+"commentbox").value;
            if (cmntbox == '') {
                document.getElementById("msg").innerHTML = "Please Enter Content.";
                $('#myModal11').modal('show');
            }
            else {
                $.post("/post_comment_1",
                    {
                        ans__id: aid,
                        que__id: qid,
                        commentbox: cmntbox
                    },
                    function (data, status) {
                        $("#refreshid").load(location.href + " #refreshid");
                    }
                );
            }
        }
    </script>

</head>
{% endblock %}
{% block body %}
<br>

    <div class="queanscontainer">
        <div class="quebox">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <span class="panel-title">
                        <span class="quetitle">
                            {{quedict['title']}}
                        </span>
            </div>
            <div class="panel-body">
                {{quedict['question_content'] | safe }}
                <hr>
                <span class="tag">
                    {% for tgitem in quedict['tag'] %}
                    <a class="label label-info taglable" href="#">{{tgitem['name']}}</a>
                    {% endfor %}
                </span>

                <span class="askerinfo">
                    <div>
                        Posted on :
                        <span>{{quedict['date']}}</span>
                    </div>
                    <div>
                        By : <span><a href="{{url_for('view_profile',uid=quedict['uid'])}}">{{quedict['ufname']}}
                                {{quedict['ulname']}}</a></span>
                    </div>
                </span>

            </div>    
                <div class="panel-footer">
                    <span>
                        {% if 1 %}
                        <span class="updownvotesym" data-toggle="popover" data-content="upvote">
                            <i class="fa fa-thumbs-o-up" onclick="upvote()"></i>
                        </span>
                        {% else %}
                        <span class="updownvotesym" data-toggle="popover" data-content="clear">
                            <i class="fa fa-thumbs-up" onclick="upvote()"></i>
                        </span>
                        {% endif %}

                        <span class="updownvotesym">{{quedict['votes']}}</span>

                        {% if 0 %}
                        <span class="updownvotesym" data-toggle="popover" data-content="downvote">
                            <i class="fa fa-thumbs-o-down" onclick="downvote()"></i>
                        </span>
                        {% else %}
                        <span class="updownvotesym" data-toggle="popover" data-content="clear">
                            <i class="fa fa-thumbs-down" onclick="downvote()"></i>
                        </span>
                        {% endif %}

                        <span style="float:right">
                            {% if 0 %}
                            <span class="bookmarksym" data-toggle="popover" data-content="answer later">
                                <span class="fa fa-plus-square-o" onclick="addtodo()"></span>
                            </span>
                            {% else %}
                            <span class="bookmarksym" data-toggle="popover" data-content="remove from TODO">
                                <span class="fa fa-plus-square" onclick="removetodo()"></span>
                            </span>

                            <span class="bookmarksym" data-toggle="popover" data-content="answered">
                                <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
                            </span>
                            {% endif %}

                            {% if 0 %}
                            <span class="bookmarksym" data-toggle="popover" data-content="bookmark">
                                <span class="glyphicon glyphicon-star-empty" aria-hidden="true" onclick="addbookmark()"></span>
                            </span>
                            {% else %}
                            <span class="bookmarksym" data-toggle="popover" data-content="remove bookmark">
                                <span class="glyphicon glyphicon-star" aria-hidden="true" onclick="removebookmark()"></span>
                            </span>
                            {% endif %}
                        </span>

                    </span>
                </div>
            </div>
        </div>
        <div id="refreshid">
        {% for i in anslist %}
        <div class="ansbox">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <span class="panel-title">
                        <span class="answertitle">
                            <span>
                                Answer by : <span><a class="ansby" href="{{url_for('view_profile',uid=i['uid'])}}">{{i['ufname']}}
                                        {{i['ulname']}}</a></span>
                            </span>
                        </span>
                    </span>

            </div>
            <div class="panel-body">
                {{ i['content'] | safe }}
                <span class="comment">
                    {% for j in i['comments'] %}
                        <span>
                            <hr class="commenthr">
                            <span>
                                {{j['content']}}
                                <span class="commentposterinfo">
                                    <span>
                                        -- by : <span><a href="{{url_for('view_profile',uid=j['uid'])}}">{{j['ufname']}}
                                                {{j['ulname']}}</a></span>
                                    </span>
                                    <span>
                                        on :
                                        <span>{{j['date']}}</span>
                                    </span>
                                </span>
                            </span>
                        </span>
                        {% endfor %}
                        <br><br>
                        <div>
                            <form method="POST">
                                <input type="hidden" name="que__id" id="que__id" value="{{quedict['id']}}">
                                <input type="hidden" name="ans__id" id="{{i['a_id']}}ansid" value="{{i['a_id']}}">
                                <div style="width:60%;float: left;">
                                    <input type="text" class="form-control" id="{{i['a_id']}}commentbox" name="commentbox"
                                        placeholder="Comment here">
                                </div>
                                <div style="float:left;margin-left: 12px">
                                    <input type="button" class="btn btn-primary" id="{{i['a_id']}}" onclick="validatecomment(this)" value="comment"
                                        {% if uid==0 %}disabled {% endif %}>
                                </div>
                            </form>
                        </div>
                </span>

                </div>
                <div class="panel-footer">
                    <span>
                        {% if 1 %}
                        <span class="updownvotesym" data-toggle="popover" data-content="upvote">
                            <i class="fa fa-thumbs-o-up" onclick="upvote()"></i>
                        </span>
                        {% else %}
                        <span class="updownvotesym" data-toggle="popover" data-content="clear">
                            <i class="fa fa-thumbs-up" onclick="upvote()"></i>
                        </span>
                        {% endif %}

                        <span class="updownvotesym">{{i['votes']}}</span>

                        {% if 0 %}
                        <span class="updownvotesym" data-toggle="popover" data-content="downvote">
                            <i class="fa fa-thumbs-o-down" onclick="downvote()"></i>
                        </span>
                        {% else %}
                        <span class="updownvotesym" data-toggle="popover" data-content="clear">
                            <i class="fa fa-thumbs-down" onclick="downvote()"></i>
                        </span>
                        {% endif %}

                        <span style="float:right">
                            <span>
                                Posted on :
                                <span>{{i['date']}}</span>
                            </span>
                        </span>

                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
        <form method="POST" name="form1">
            <div class="col-md-12 form-group group-mail">
                <!-- <div id="summernote"></div> -->
                <textarea class="summernote" id="summernote" name="editordata"></textarea>
            </div>
            <input type="hidden" value="{{quedict['id']}}" name="qid" id="qid">
            <div class="col-md-12 form-group group-mail">
                <button type="button" class="btn btn-primary" onclick="validate()" {% if chkbtn==1 or uid==0 %}disabled
                    {% endif %}>
                    Post Answer
                </button>
            </div>
        </form>


    </div>
<div class="sidebar">
    <fieldset>
        <legend>Search</legend>
        <div>
            <form action="{{url_for('search_question')}}" method="post" name="search_que_form">
                <div style="width:80%;float:left">
                    <input class="form-control" type="text" name="search_question_input" id="search_question_input1" placeholder="Search Question" required>
                </div>
                <div style="width:15%;float:left;margin-left: 5px;">
                
                    <button type="submit" class="btn btn-default">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </div>
            </form>

            <br><br>

            <form action="{{url_for('search_tag')}}" method="post" name="search_tag_form">
                <div style="width:80%;float:left">
                    <input class="form-control" type="text" name="search_tag_input" id="search_tag_input1" placeholder="Search by Tag" required>
                </div>
                <div style="width:15%;float:left;margin-left: 5px;">
                    <button type="submit" class="btn btn-default">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </div>
            </form>

            <br><br>

            <form action="{{url_for('search_user')}}" method="post" name="search_que_form">
                <div style="width:80%;float:left">
                    <input class="form-control" type="text" name="search_user_input" id="search_user_input1" placeholder="Search by User" required>
                </div>
                <div style="width:15%;float:left;margin-left: 5px;">
                    <button type="submit" class="btn btn-default">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </div>
            </form>

        </div>
    </fieldset>
    <br>
    <div>
        <a href="{{ url_for('ask_question') }}" class="btn btn-primary">Ask Question</a>
    </div>
    <br>
</div>
<div class="clearfix"></div>

<script>
    $('#summernote').summernote({
        toolbar: [
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['insert', ['link', 'picture']],
            ['para', ['ol']],
        ],
        placeholder: 'Type your answer here',
        tabsize: 2,
        height: 250
    });
    $('#summernote').load(document.URL + ' #summernote', function () {
        alert("hello")
        $('#summernote').summernote();        
    });

</script>

{% endblock %}